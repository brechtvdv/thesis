/*
 demo-optimization 2015-12-29 
*/
function CsvGenerator(a,b,c,d){this.dataArray=a,this.fileName=b,this.separator=c||",",this.addQuotes=!!d,this.addQuotes&&(this.separator='"'+this.separator+'"'),this.getDownloadLink=function(){var a=this.separator,b=this.addQuotes,c=this.dataArray.map(function(c){var d=c.join(a);return d.length&&b?'"'+d+'"':d}),d="data:text/csv;charset=utf-8",e=c.join("\n");return"function"==typeof btoa?(d+=";base64",e=btoa(e)):e=encodeURIComponent(e),this.downloadLink=this.downloadLink||d+","+e,this.downloadLink},this.getLinkElement=function(a){var b=this.getDownloadLink();return this.linkElement=this.linkElement||$("<a>"+(a||"")+"</a>",{href:b,download:this.fileName}),this.linkElement},this.download=function(a){this.getLinkElement().css("display","none").appendTo("body"),this.getLinkElement()[0].click(),a&&this.getLinkElement().remove()}}$(document).ready(function(){}),$(function(){$(".chosen-select").chosen(),$(".chosen-select-deselect").chosen({allow_single_deselect:!0});var a=L.icon({iconUrl:"../../images/leaf-green.png",shadowUrl:"../../images/leaf-shadow.png",iconSize:[38,95],shadowSize:[50,64],iconAnchor:[22,94],shadowAnchor:[4,62],popupAnchor:[-3,-76]}),b=L.map("map").setView([50.893,5.702],7),c=[],d=[];L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(b);var e=function(e,f){var g=(new Date).getTime(),h=0,i=0,j=0;$(".amounttime").text("0");var k;k="heuristic"==$("input[name='radioBtn']:checked").val()?new window.lc.HeuristicClient({entrypoints:["http://localhost:8080/"]}):"regular"==$("input[name='radioBtn']:checked").val()?new window.lc.Client({entrypoints:["http://localhost:8080/"]}):new window.lc.SpeedUpClient({entrypoints:["http://localhost:8080/"]}),k.query({departureStop:e.toString(),arrivalStop:f.toString(),departureTime:new Date("2015-12-01T06:00"),arrivalStopLongitude:stops[f].loc.coordinates[0],arrivalStopLatitude:stops[f].loc.coordinates[1],departureStopLongitude:stops[e].loc.coordinates[0],departureStopLatitude:stops[e].loc.coordinates[1]},function(e,f){e.on("result",function(a){var b;b=a[0]["gtfs:trip"]?a[0]["gtfs:trip"]["@id"]:a[0].trip["@id"],$(".resulttable").find("tbody:last").append('<tr><th scope="row">Vertrekdatum: '+a[0].departureTime.getFullYear()+"-"+(a[0].departureTime.getMonth()+1).toString()+"-"+a[0].departureTime.getDate()+"</th></tr>"),$.each(a,function(c,d){var e;e=a[0]["gtfs:trip"]?a[0]["gtfs:trip"]["@id"]:a[0].trip["@id"],e!=b&&($(".resulttable").find("tbody:last").append('<tr style="color: blue;"><th scope="row" class="list-group-item-info">OVERSTAP</th></tr>'),b=e),stops[d.departureStop]&&stops[d.arrivalStop]?$(".resulttable").find("tbody:last").append('<tr><th scope="row">'+stops[d.departureStop].stop_name+"</th><td>"+("0"+d.departureTime.getHours()).slice(-2)+":"+("0"+d.departureTime.getMinutes()).slice(-2)+"</td><td>"+stops[d.arrivalStop].stop_name+"</td><td>"+("0"+d.arrivalTime.getHours()).slice(-2)+":"+("0"+d.arrivalTime.getMinutes()).slice(-2)+"</td></tr>"):stops[d.departureStop]?$(".resulttable").find("tbody:last").append('<tr><th scope="row">'+stops[d.departureStop].stop_name+"</th><td>"+("0"+d.departureTime.getHours()).slice(-2)+":"+("0"+d.departureTime.getMinutes()).slice(-2)+"</td><td>"+d.arrivalStop+"</td><td>"+("0"+d.arrivalTime.getHours()).slice(-2)+":"+("0"+d.arrivalTime.getMinutes()).slice(-2)+"</td></tr>"):stops[d.arrivalStop]?$(".resulttable").find("tbody:last").append('<tr><th scope="row">'+d.departureStop+"</th><td>"+("0"+d.departureTime.getHours()).slice(-2)+":"+("0"+d.departureTime.getMinutes()).slice(-2)+"</td><td>"+stops[d.arrivalStop].stop_name+"</td><td>"+("0"+d.arrivalTime.getHours()).slice(-2)+":"+("0"+d.arrivalTime.getMinutes()).slice(-2)+"</td></tr>"):$(".resulttable").find("tbody:last").append('<tr><th scope="row">'+d.departureStop+"</th><td>"+("0"+d.departureTime.getHours()).slice(-2)+":"+("0"+d.departureTime.getMinutes()).slice(-2)+"</td><td>"+d.arrivalStop+"</td><td>"+("0"+d.arrivalTime.getHours()).slice(-2)+":"+("0"+d.arrivalTime.getMinutes()).slice(-2)+"</td></tr>")})}),e.on("departureStop",function(d){var e=d.stopId,f=stops[e],g=L.marker([f.loc.coordinates[1],f.loc.coordinates[0]],{icon:a}).addTo(b).bindPopup("Stop ID: "+e+"\nPriority: "+d.priority+"\nName: "+f.stop_name+"\nLatitude: "+f.loc.coordinates[0]+"\nLongitude: "+f.loc.coordinates[1]);c.push(g)}),e.on("data",function(a){j++,$(".mobconnections").text(j);var c=stops[a.arrivalStop],e=stops[a.departureStop];if("undefined"!=typeof c&&"undefined"!=typeof e){var f=new L.LatLng(e.loc.coordinates[1],e.loc.coordinates[0]),g=new L.LatLng(c.loc.coordinates[1],c.loc.coordinates[0]),h=new L.Polyline([f,g],{color:"#3b6790",weight:6,smoothFactor:4});d.push(h),h.addTo(b)}}),e.on("error",function(a){console.error(a)}),f.on("request",function(a){console.log("Request sent to "+a),h++,$(".amountrequests").text(h)}),f.on("data",function(){i++,$(".totalamountconnections").text(i);var a=(new Date).getTime(),b=a-g;$(".amounttime").text(b/1e3)}),e.on("end",function(){var a=(new Date).getTime(),b=a-g;$(".amounttime").text(b/1e3)})})},f=function(){for(var a=0;a<c.length;a++)b.removeLayer(c[a]);for(var e=0;e<d.length;e++)b.removeLayer(d[e]);c=[],d=[]},g=function(){$(".resulttable tbody tr").remove()};$("#zoek").on("click",function(){f(),g();var a=$(".stopvan option:selected").val(),d=$(".stopnaar option:selected").val();""===a&&(a="8881125"),""===d&&(d="8866407");var h=stops[a],i=stops[d],j=new L.geoJson(h.loc);c.push(j),j.addTo(b).bindPopup("Stop ID: "+a+"\nName: "+h.stop_name+"\nLatitude: "+h.loc.coordinates[0]+"\nLongitude: "+h.loc.coordinates[1]),j=L.geoJson(i.loc),c.push(j),j.addTo(b).bindPopup("Stop ID: "+d+"\nName: "+i.stop_name+"\nLatitude: "+i.loc.coordinates[0]+"\nLongitude: "+i.loc.coordinates[1]);var k=h.connection_stop_id,l=i.connection_stop_id;e(k,l)})}),$(function(){function a(a,b){function c(a){return a*Math.PI/180}var d=a[0],e=a[1],f=b[0],g=b[1],h=6371,i=g-e,j=c(i),k=f-d,l=c(k),m=Math.sin(j/2)*Math.sin(j/2)+Math.cos(c(e))*Math.cos(c(g))*Math.sin(l/2)*Math.sin(l/2),n=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),o=h*n;return o}var b=[],c=0,d=function(e,f){var g=0,h=0,i=0,j=0,k=0,l=0,m=new window.lc.HeuristicClient({entrypoints:["http://localhost:8080/"]}),n=(new Date).getTime(),o=f[e].departureStop.toString(),p=f[e].arrivalStop.toString();console.log(o),console.log(p);var q=[stops[o].loc.coordinates[0],stops[o].loc.coordinates[1]],r=[stops[p].loc.coordinates[0],stops[p].loc.coordinates[1]],s=a(q,r);console.log(s),m.query({departureStop:o,arrivalStop:p,departureTime:new Date("2015-12-01T06:00")},function(a,m){a.on("result",function(a){var l,m;l=(new Date).getTime(),m=l-n,k=m/1e3,console.log(k),routeMinutes=(a[a.length-1].arrivalTime.getTime()-a[0].departureTime.getTime())/6e4,amountOfStops=a.length;var o=[f[e].departureStop,f[e].arrivalStop,i,h,j,g,k,amountOfStops,routeMinutes,s];b.push(o),e<queriesNMBS.length?(e++,c++,console.log(c),d(e,f)):console.log("Klaar met benchmarking")}),a.on("data",function(a){j++}),a.on("departureStop",function(){l++}),m.on("count",function(a){i=a}),m.on("stop",function(){console.log("stop"),routeMinutes=9999,amountOfStops=9999;var a=[f[e].departureStop,f[e].arrivalStop,i,h,j,g,k,amountOfStops,routeMinutes,s];b.push(a),e++,c++,console.log(c),d(e,f)}),m.on("request",function(a){g++}),m.on("data",function(){h++}),m.on("error",function(){console.log("query not found"),e++,d(e,f)})})};$("#queryNMBS").on("click",function(){b=[["start_stop_id","end_stop_id","count","scan","mob","request","tijd","stops","routeduur","afstand"]],d(0,queriesNMBS)}),$("#download").on("click",function(){csvGenerator=new CsvGenerator(b,"basicCSA.csv"),csvGenerator.download(!0)})}),$(function(){});