/*
 demo-optimization 2015-11-26 
*/
$(document).ready(function(){$.each(stops,function(a,b){$(".stopvan").append("<option value='"+a+"'>"+b.stop_name+"</option>")}),$(".stopvan").trigger("chosen:updated"),$.each(stops,function(a,b){$(".stopnaar").append("<option value='"+a+"'>"+b.stop_name+"</option>")}),$(".stopnaar").trigger("chosen:updated")}),$(function(){$(".chosen-select").chosen(),$(".chosen-select-deselect").chosen({allow_single_deselect:!0});var a=L.map("map").setView([50.893,5.702],7);L.tileLayer("http://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(a);var b=new window.lc.Client({entrypoints:["http://belgianrail.linkedconnections.org/"]}),c=function(c,d){var e=(new Date).getTime(),f=0,g=0,h=0;$(".amounttime").text("0"),b.query({departureStop:c.toString(),arrivalStop:d.toString(),departureTime:new Date("2015-10-05T10:00")},function(b){b.on("result",function(a){var b,c=!0;$(".resulttable").find("tbody:last").append('<tr><th scope="row">Vertrekdatum: '+a[0].departureTime.getFullYear()+"-"+(a[0].departureTime.getMonth()+1).toString()+"-"+a[0].departureTime.getDate()+"</th></tr>"),$.each(a,function(a,d){b?d["gtfs:trip"]["@id"]!=b&&c?(c=!1,b=d["gtfs:trip"]["@id"]):d["gtfs:trip"]["@id"]!=b&&($(".resulttable").find("tbody:last").append('<tr style="color: blue;"><th scope="row" class="list-group-item-info">OVERSTAP</th></tr>'),b=d["gtfs:trip"]["@id"]):b=d["gtfs:trip"]["@id"],stops[d.departureStop]&&stops[d.arrivalStop]?$(".resulttable").find("tbody:last").append('<tr><th scope="row">'+stops[d.departureStop].stop_name+"</th><td>"+("0"+d.departureTime.getHours()).slice(-2)+":"+("0"+d.departureTime.getMinutes()).slice(-2)+"</td><td>"+stops[d.arrivalStop].stop_name+"</td><td>"+("0"+d.arrivalTime.getHours()).slice(-2)+":"+("0"+d.arrivalTime.getMinutes()).slice(-2)+"</td></tr>"):stops[d.departureStop]?$(".resulttable").find("tbody:last").append('<tr><th scope="row">'+stops[d.departureStop].stop_name+"</th><td>"+("0"+d.departureTime.getHours()).slice(-2)+":"+("0"+d.departureTime.getMinutes()).slice(-2)+"</td><td>"+d.arrivalStop+"</td><td>"+("0"+d.arrivalTime.getHours()).slice(-2)+":"+("0"+d.arrivalTime.getMinutes()).slice(-2)+"</td></tr>"):stops[d.arrivalStop]?$(".resulttable").find("tbody:last").append('<tr><th scope="row">'+d.departureStop+"</th><td>"+("0"+d.departureTime.getHours()).slice(-2)+":"+("0"+d.departureTime.getMinutes()).slice(-2)+"</td><td>"+stops[d.arrivalStop].stop_name+"</td><td>"+("0"+d.arrivalTime.getHours()).slice(-2)+":"+("0"+d.arrivalTime.getMinutes()).slice(-2)+"</td></tr>"):$(".resulttable").find("tbody:last").append('<tr><th scope="row">'+d.departureStop+"</th><td>"+("0"+d.departureTime.getHours()).slice(-2)+":"+("0"+d.departureTime.getMinutes()).slice(-2)+"</td><td>"+d.arrivalStop+"</td><td>"+("0"+d.arrivalTime.getHours()).slice(-2)+":"+("0"+d.arrivalTime.getMinutes()).slice(-2)+"</td></tr>")})}),b.on("data",function(b){h++,$(".mobconnections").text(h);var c=stops[b.arrivalStop],d=stops[b.departureStop];if("undefined"!=typeof c&&"undefined"!=typeof d){var e=new L.LatLng(d.loc.coordinates[1],d.loc.coordinates[0]),f=new L.LatLng(c.loc.coordinates[1],c.loc.coordinates[0]);new L.Polyline([e,f],{color:"#3b6790",weight:6,smoothFactor:4}).addTo(a)}}),b.on("error",function(a){console.error(a)}),b.on("request",function(){f++,$(".amountrequests").text(f)}),b.on("scan",function(){g++,$(".totalamountconnections").text(g);var a=(new Date).getTime(),b=a-e;$(".amounttime").text(b/1e3)}),b.on("end",function(){var a=(new Date).getTime(),b=a-e;$(".amounttime").text(b/1e3),console.log("end of stream")})})};$("#zoek").on("click",function(){var b=$(".stopvan option:selected").val(),d=$(".stopnaar option:selected").val();""===b&&(b="8400526"),""===d&&(d="8892007");var e=stops[b],f=stops[d];L.geoJson(e.loc).addTo(a).bindPopup("Stop ID: "+b+"\nName: "+e.stop_name+"\nLatitude: "+e.loc.coordinates[0]+"\nLongitude: "+e.loc.coordinates[1]),L.geoJson(f.loc).addTo(a).bindPopup("Stop ID: "+d+"\nName: "+f.stop_name+"\nLatitude: "+f.loc.coordinates[0]+"\nLongitude: "+f.loc.coordinates[1]);var g=e.connection_stop_id,h=f.connection_stop_id;c(g,h)})});